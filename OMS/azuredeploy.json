{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "omsLogAnalyticsWorkspaceName": {
      "type": "string",
      "defaultValue": "OMSLogAnalytics",
      "metadata": {
        "description": "The name of the OMS Log Analytics workspace that will be created."
      }
    },
    "omsLogAnalyticsWorkspaceLocation": {
      "type": "string",
      "allowedValues": [
        "East US",
        "West Europe"
      ],
      "metadata": {
        "description": "The region to deploy OMS Log Analytics workspace in."
      },
      "defaultValue": "West Europe"
    },
    "omsLogAnalyticsWorkspaceSku": {
      "type": "string",
      "allowedValues": [
        "Free",
        "Standard",
        "Premium"
      ],
      "defaultValue": "Premium",
      "metadata": {
        "description": "The SKU of OMS Log Analytics workspace."
      }
    },
    "omsLogAnalyticsWorkspaceApiVersion": {
      "type": "string",
      "allowedValues": [
        "2015-11-01-preview",
        "2015-03-20",
        "2014-11-10",
        "2014-10-10"
      ],
      "defaultValue": "2015-03-20",
      "metadata": {
        "description": "The API version of Microsoft.OperationalInsights/workspaces resource provider."
      }
    },
    "omsLogAnalyticsEnableCapacitySolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Capacity Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableSecurityAndAuditSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Security and Audit Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableSystemUpdateAssessmentSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics System Update Assessment Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableAntimalwareAssesmentSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Antimalware Assessment Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableLogManagementSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Log Management Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableChangeTrackingSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Change Tracking Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableSQLAssessmentSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics SQL Assessment Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableADAssessmentSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics AD Assessment Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableAlertManagementSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Alert Management Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableAutomationSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Automation Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableWireDataSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Wire Data Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableSiteRecoverySolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Site Recovery Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableBackupSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Backup Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableSurfaceHubSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Surface Hub Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableNetworkPerformanceMonitorSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Network Performance Monitor Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableContainersSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Containers Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableAzureNetworkAnalyticsSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Azure Network Analytics Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableADReplicationSolution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics AD Replication Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsLogAnalyticsEnableOffice365Solution": {
      "type": "string",
      "allowedValues": [
        "True",
        "False",
        "None"
      ],
      "defaultValue": "True",
      "metadata": {
        "description": "Enable/Disable OMS Log Analytics Office365 Solution. True value enables it. False value disables it. None value does not make changes."
      }
    },
    "omsAutomationAccountName": {
      "type": "string",
      "defaultValue": "OMSAutomation",
      "metadata": {
        "description": "The name of the OMS Automation account to create and deploy to."
      }
    },
    "omsAutomationAccountLocation": {
      "type": "string",
      "defaultValue": "West Europe",
      "allowedValues": [
        "Japan East",
        "East US 2",
        "West Europe",
        "Southeast Asia",
        "South Central US"
      ],
      "metadata": {
        "description": "The region to deploy the OMS Automation account in."
      }
    },
    "omsAutomationSku": {
      "type": "string",
      "defaultValue": "Basic",
      "allowedValues": [
        "Free",
        "Basic"
      ],
      "metadata": {
        "description": "The SKU for OMS Automation account."
      }
    },
    "omsAutomationApiVersion": {
      "type": "string",
      "allowedValues": [
        "2015-01-01-preview",
        "2015-10-31"
      ],
      "defaultValue": "2015-10-31",
      "metadata": {
        "description": "The API version of Microsoft.Automation/automationAccounts resource provider."
      }
    },
    "runbookJobIdSetOMSAutomationVariable": {
      "type": "string",
      "defaultValue": "9ddbe4e4-56f0-43b7-a3a9-5df4648401cd",
      "metadata": {
        "description": "Valid and unique GUID to execute job for runbook Set-OMSAutomationVariable."
      }
    },
    "runbookJobIdSetOMSLogAnalyticsIntelligencePack": {
      "type": "string",
      "defaultValue": "33df2d66-5f2e-4957-ac9f-b1bb27e4d0c5",
      "metadata": {
        "description": "Valid and unique GUID to execute job for runbook Set-OMSLogAnalyticsIntelligencePack."
      }
    },
    "azureServiceAccountUserName": {
      "type": "string",
      "metadata": {
        "description": "The username for service account in Azure. The account will be used in Azure Automation to perform tasks on Azure Resources."
      }
    },
    "azureServiceAccountPassword": {
      "type": "secureString",
      "metadata": {
        "description": "The password for service account in Azure. The account will be used in Azure Automation to perform tasks on Azure Resources."
      }
    }
  },
  "variables": {
    "automationVariables": {
      "AzureSubscriptionID": {
        "variableName": "AzureSubscriptionID",
        "variableDescription": "Azure Subscription ID."
      },
      "OMSAutomationAccountName": {
        "variableName": "OMSAutomationAccountName",
        "variableDescription": "OMS Automation Account Name."
      },
      "OMSAutomationAccountResourceGroup": {
        "variableName": "OMSAutomationAccountResourceGroup",
        "variableDescription": "OMS Automation Account Resource Group Name."
      },
      "OMSAutomationAccountURL": {
        "variableName": "OMSAutomationAccountURL",
        "variableDescription": "OMS Automation Account URL."
      },
      "OMSAutomationAccountPrimaryKey": {
        "variableName": "OMSAutomationAccountPrimaryKey",
        "variableDescription": "OMS Automation Account Primary Access Key."
      },
      "OMSLogAnalyticsWorkspaceName": {
        "variableName": "OMSLogAnalyticsWorkspaceName",
        "variableDescription": "Name of the OMS Log Analytics Workspace."
      },
      "OMSLogAnalyticsWorkspaceResourceGroup": {
        "variableName": "OMSLogAnalyticsWorkspaceResourceGroup",
        "variableDescription": "OMS Log Analytics Resource Group Name."
      },
      "OMSLogAnalyticsWorkspaceID": {
        "variableName": "OMSLogAnalyticsWorkspaceID",
        "variableDescription": "OMS Log Analytics Workspace ID."
      },
      "OMSLogAnalyticsWorkspacePrimaryKey": {
        "variableName": "OMSLogAnalyticsWorkspacePrimaryKey",
        "variableDescription": "OMS Log Analytics Workspace Primary Access Key."
      }
    },
    "automationCredentials": {
      "AzureCredentials": {
        "credentialName": "AzureCredentials",
        "credentialDescription": "Administrator Credentials for Azure Subscription(s)."
      }
    },
    "PowerShellModules": {
      "AzureRMOperationalInsights": {
        "moduleName": "AzureRM.OperationalInsights",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.operationalinsights.1.0.4.nupkg"
      },
      "AzureRMAutomation": {
        "moduleName": "AzureRM.Automation",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.automation.1.0.4.nupkg"
      },
      "AzureRMCompute": {
        "moduleName": "AzureRM.Compute",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.compute.1.2.3.nupkg"
      },
      "AzureRMResources": {
        "moduleName": "AzureRM.Resources",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.resources.1.0.4.nupkg"
      },
      "AzureRMSql": {
        "moduleName": "AzureRM.SQL",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.sql.1.0.4.nupkg"
      },
      "AzureRMSstorage": {
        "moduleName": "AzureRM.Storage",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.storage.1.0.4.nupkg"
      },
      "AzureStorage": {
        "moduleName": "Azure.Storage",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azure.storage.1.0.4.nupkg"
      },
      "AzureRMProfile": {
        "moduleName": "AzureRM.Profile",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.profile.1.0.4.nupkg"
      },
      "Azure": {
        "moduleName": "Azure",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azure.1.0.4.nupkg"
      },
      "AzureRMBackup": {
        "moduleName": "AzureRM.Backup",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.backup.1.0.4.nupkg"
      },
      "AzureRMNetwork": {
        "moduleName": "AzureRM.Network",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.network.1.0.4.nupkg"
      },
      "AzureRMHDInsight": {
        "moduleName": "AzureRM.HDInsight",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.hdinsight.1.0.5.nupkg"
      },
      "AzureRMBatch": {
        "moduleName": "AzureRM.Batch",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.batch.1.0.4.nupkg"
      },
      "AzureRMApiManagement": {
        "moduleName": "AzureRM.ApiManagement",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.apimanagement.1.0.4.nupkg"
      },
      "AzureRMInsights": {
        "moduleName": "AzureRM.Insights",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.insights.1.0.4.nupkg"
      },
      "AzureRMDns": {
        "moduleName": "AzureRM.Dns",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.dns.1.0.4.nupkg"
      },
      "AzureRMWebsites": {
        "moduleName": "AzureRM.Websites",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.websites.1.0.4.nupkg"
      },
      "AzureRMTags": {
        "moduleName": "AzureRM.Tags",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.tags.1.0.4.nupkg"
      },
      "AzureRMDataFactories": {
        "moduleName": "AzureRM.DataFactories",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.datafactories.1.0.4.nupkg"
      },
      "AzureRMSiteRecovery": {
        "moduleName": "AzureRM.SiteRecovery",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.siterecovery.1.1.3.nupkg"
      },
      "AzureRMKeyVault": {
        "moduleName": "AzureRM.KeyVault",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.keyvault.1.1.3.nupkg"
      },
      "AzureRMRedisCache": {
        "moduleName": "AzureRM.RedisCache",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.rediscache.1.1.2.nupkg"
      },
      "AzureRMStreamAnalytics": {
        "moduleName": "AzureRM.StreamAnalytics",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.streamanalytics.1.0.4.nupkg"
      },
      "AzureRMTrafficManager": {
        "moduleName": "AzureRM.TrafficManager",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.trafficmanager.1.0.4.nupkg"
      },
      "AzureRMUsageAggregates": {
        "moduleName": "AzureRM.UsageAggregates",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.usageaggregates.1.0.4.nupkg"
      },
      "AzureRMDataLakeStore": {
        "moduleName": "AzureRM.DataLakeStore",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.datalakestore.1.0.4.nupkg"
      },
      "AzureRMDataLakeAnalytics": {
        "moduleName": "AzureRM.DataLakeAnalytics",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.datalakeanalytics.1.0.4.nupkg"
      },
      "AzureRMRecoveryServices": {
        "moduleName": "AzureRM.RecoveryServices",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.recoveryservices.1.0.5.nupkg"
      },
      "AzureRMNotificationHubs": {
        "moduleName": "AzureRM.NotificationHubs",
        "moduleUri": "https://devopsgallerystorage.blob.core.windows.net/packages/azurerm.notificationhubs.1.0.4.nupkg"
      }
    },
    "PowerShellDSCModules": {
      "xHybridRegistration": {
        "moduleName": "xHybridRegistration",
        "moduleUri": "https://incubationstor.blob.core.windows.net/modules/xHybridRegistration.zip"
      }
    },
    "runbooks": {
      "SetOMSAutomationVariable": {
        "runbookName": "Set-OMSAutomationVariable",
        "runbookURL": "https://incubationstor.blob.core.windows.net/runbooks/Set-OMSAutomationVariable.ps1",
        "runbookVersion": "1.0.0.0",
        "runbookDescription": "Gets and sets values for variables OMSAutomationAccountPrimaryKey, OMSLogAnalyticsWorkspacePrimaryKey, OMSAutomationAccountURL and credential OMSAutomationAccountURLandPrimaryKey.",
        "runbookType": "PowerShell",
        "runbookJobId": "[parameters('runbookJobIdSetOMSAutomationVariable')]"
      },
      "SetOMSLogAnalyticsIntelligencePack": {
        "runbookName": "Set-OMSLogAnalyticsIntelligencePack",
        "runbookURL": "https://incubationstor.blob.core.windows.net/runbooks/Set-OMSLogAnalyticsIntelligencePack.ps1",
        "runbookVersion": "1.0.0.0",
        "runbookDescription": "Enables different solutions in OMS Log Analytics workspace.",
        "runbookType": "PowerShell",
        "runbookJobId": "[parameters('runbookJobIdSetOMSLogAnalyticsIntelligencePack')]"
      },
      "InstallOMSLogAnalyticsVMExtension": {
        "runbookName": "Install-OMSLogAnalyticsVMExtension",
        "runbookURL": "https://incubationstor.blob.core.windows.net/runbooks/Install-OMSLogAnalyticsVMExtension.ps1",
        "runbookVersion": "1.0.0.0",
        "runbookDescription": "Installs Azure VM OMS Extension on Linux and Windows VMs.",
        "runbookType": "PowerShell",
        "runbookJobId": ""
      },
      "SetHybridWorkerDSCConfiguration": {
        "runbookName": "Set-HybridWorkerDSCConfiguration",
        "runbookURL": "https://incubationstor.blob.core.windows.net/runbooks/Set-HybridWorkerDSCConfiguration.ps1",
        "runbookVersion": "1.0.0.0",
        "runbookDescription": "Configures DSC node as Hybrid worker via DSC Configuration.",
        "runbookType": "PowerShell",
        "runbookJobId": ""
      },
      "RegisterOMSAutomationDSCNode": {
        "runbookName": "Register-OMSAutomationDSCNode",
        "runbookURL": "https://incubationstor.blob.core.windows.net/runbooks/Register-OMSAutomationDSCNode.ps1",
        "runbookVersion": "1.0.0.0",
        "runbookDescription": "Register Linux or Windows machine to Automation DSC.",
        "runbookType": "PowerShell",
        "runbookJobId": ""
      }
    },
    "DSCConfigurations": {
      "SetHybridWorker": {
        "configurationName": "SetHybridWorker",
        "configurationDescription": "Sets Hybrid Worker Configuration on server.",
        "configurationURI": "https://incubationstor.blob.core.windows.net/dsconfigurations/SetHybridWorker.ps1",
        "dscOverwrite": "true"
      }
    }
  },
  "resources": [
    {
      "apiVersion": "[parameters('omsLogAnalyticsWorkspaceApiVersion')]",
      "name": "[parameters('omsLogAnalyticsWorkspaceName')]",
      "type": "Microsoft.OperationalInsights/workspaces",
      "location": "[parameters('omsLogAnalyticsWorkspaceLocation')]",
      "id": "[Concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.OperationalInsights/workspaces/', parameters('omsLogAnalyticsWorkspaceName'))]",
      "properties": {
        "sku": {
          "name": "[parameters('omsLogAnalyticsWorkspaceSku')]"
        }
      },
      "resources": [

      ]
    },
    {
      "name": "[parameters('omsAutomationAccountName')]",
      "type": "Microsoft.Automation/automationAccounts",
      "apiVersion": "[parameters('omsAutomationApiVersion')]",
      "location": "[parameters('omsAutomationAccountLocation')]",
      "dependsOn": [ ],
      "tags": { },
      "properties": {
        "comment": "Resource defined structure",
        "sku": {
          "name": "[parameters('omsAutomationSku')]"
        }
      },
      "resources": [
        {
          "name": "[variables('automationVariables').AzureSubscriptionID.variableName]",
          "type": "variables",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": {
          },
          "properties": {
            "description": "[variables('automationVariables').AzureSubscriptionID.variableDescription]",
            "isEncrypted": 0,
            "type": "string",
            "value": "[concat('\"',subscription().subscriptionId,'\"')]"
          }
        },
        {
          "name": "[variables('automationVariables').OMSAutomationAccountName.variableName]",
          "type": "variables",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": {
          },
          "properties": {
            "description": "[variables('automationVariables').OMSAutomationAccountName.variableDescription]",
            "isEncrypted": 0,
            "type": "string",
            "value": "[concat('\"',parameters('omsAutomationAccountName'),'\"')]"
          }
        },
        {
          "name": "[variables('automationVariables').OMSAutomationAccountResourceGroup.variableName]",
          "type": "variables",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": {
          },
          "properties": {
            "description": "[variables('automationVariables').OMSAutomationAccountResourceGroup.variableDescription]",
            "isEncrypted": 0,
            "type": "string",
            "value": "[concat('\"',resourceGroup().name,'\"')]"
          }
        },
        {
          "name": "[variables('automationVariables').OMSAutomationAccountURL.variableName]",
          "type": "variables",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": {
          },
          "properties": {
            "description": "[variables('automationVariables').OMSAutomationAccountURL.variableDescription]",
            "isEncrypted": 0,
            "type": "string",
            "value": "[concat('\"','dummy','\"')]"
          }
        },
        {
          "name": "[variables('automationVariables').OMSAutomationAccountPrimaryKey.variableName]",
          "type": "variables",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": {
          },
          "properties": {
            "description": "[variables('automationVariables').OMSAutomationAccountPrimaryKey.variableDescription]",
            "isEncrypted": 1,
            "type": "string",
            "value": "[concat('\"','dummy','\"')]"
          }
        },
        {
          "name": "[variables('automationVariables').OMSLogAnalyticsWorkspaceName.variableName]",
          "type": "variables",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": {
          },
          "properties": {
            "description": "[variables('automationVariables').OMSLogAnalyticsWorkspaceName.variableDescription]",
            "isEncrypted": 0,
            "type": "string",
            "value": "[concat('\"',parameters('omsLogAnalyticsWorkspaceName'),'\"')]"
          }
        },
        {
          "name": "[variables('automationVariables').OMSLogAnalyticsWorkspaceResourceGroup.variableName]",
          "type": "variables",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": {
          },
          "properties": {
            "description": "[variables('automationVariables').OMSLogAnalyticsWorkspaceResourceGroup.variableName]",
            "isEncrypted": 0,
            "type": "string",
            "value": "[concat('\"',resourceGroup().name,'\"')]"
          }
        },
        {
          "name": "[variables('automationVariables').OMSLogAnalyticsWorkspaceID.variableName]",
          "type": "variables",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": {
          },
          "properties": {
            "description": "[variables('automationVariables').OMSLogAnalyticsWorkspaceID.variableDescription]",
            "isEncrypted": 0,
            "type": "string",
            "value": "[concat('\"',reference(Concat('Microsoft.OperationalInsights/workspaces/', parameters('omsLogAnalyticsWorkspaceName')), parameters('omsLogAnalyticsWorkspaceApiVersion')).customerId,'\"')]"
          }
        },
        {
          "name": "[variables('automationVariables').OMSLogAnalyticsWorkspacePrimaryKey.variableName]",
          "type": "variables",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": {
          },
          "properties": {
            "description": "[variables('automationVariables').OMSLogAnalyticsWorkspacePrimaryKey.variableDescription]",
            "isEncrypted": 1,
            "type": "string",
            "value": "[concat('\"','dummy','\"')]"
          }
        },
        {
          "name": "[variables('automationCredentials').AzureCredentials.credentialName]",
          "type": "credentials",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "tags": { },
          "properties": {
            "description": "[variables('automationCredentials').AzureCredentials.credentialDescription]",
            "password": "[parameters('azureServiceAccountPassword')]",
            "userName": "[parameters('azureServiceAccountUserName')]"
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMOperationalInsights.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMOperationalInsights.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMAutomation.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMAutomation.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMCompute.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMCompute.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMResources.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMResources.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMSql.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMSql.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMSstorage.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureStorage.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMSstorage.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureStorage.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').Azure.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureStorage.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMProfile.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMProfile.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').Azure.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').Azure.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMBackup.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMBackup.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMNetwork.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMNetwork.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMHDInsight.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMHDInsight.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMBatch.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMBatch.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMApiManagement.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMApiManagement.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMInsights.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMInsights.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMDns.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMDns.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMWebsites.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMWebsites.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMTags.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMTags.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMDataFactories.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMDataFactories.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMSiteRecovery.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMSiteRecovery.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMKeyVault.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMKeyVault.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMRedisCache.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMRedisCache.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMStreamAnalytics.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMStreamAnalytics.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMTrafficManager.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMTrafficManager.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMUsageAggregates.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMUsageAggregates.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMDataLakeStore.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMDataLakeStore.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMDataLakeAnalytics.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMDataLakeAnalytics.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMRecoveryServices.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMRecoveryServices.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellModules').AzureRMNotificationHubs.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMProfile.ModuleName)]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellModules').AzureRMNotificationHubs.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('PowerShellDSCModules').xHybridRegistration.ModuleName]",
          "type": "Modules",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "tags": { },
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]"
          ],
          "properties": {
            "contentLink": {
              "uri": "[variables('PowerShellDSCModules').xHybridRegistration.ModuleUri]"
            }
          }
        },
        {
          "name": "[variables('runbooks').SetOMSAutomationVariable.runbookName]",
          "type": "runbooks",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMOperationalInsights.ModuleName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMAutomation.ModuleName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').OMSLogAnalyticsWorkspaceName.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').OMSLogAnalyticsWorkspaceResourceGroup.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').OMSAutomationAccountName.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').OMSAutomationAccountResourceGroup.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').AzureSubscriptionID.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/credentials/', variables('automationCredentials').AzureCredentials.credentialName)]"
          ],
          "tags": { },
          "properties": {
            "runbookType": "[variables('runbooks').SetOMSAutomationVariable.runbookType]",
            "logProgress": "false",
            "logVerbose": "false",
            "description": "[variables('runbooks').SetOMSAutomationVariable.runbookDescription]",
            "publishContentLink": {
              "uri": "[variables('runbooks').SetOMSAutomationVariable.runbookURL]",
              "version": "[variables('runbooks').SetOMSAutomationVariable.runbookVersion]"
            }
          }
        },
        {
          "name": "[variables('runbooks').SetOMSLogAnalyticsIntelligencePack.runbookName]",
          "type": "runbooks",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMOperationalInsights.ModuleName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').OMSLogAnalyticsWorkspaceName.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').OMSLogAnalyticsWorkspaceResourceGroup.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').AzureSubscriptionID.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/credentials/', variables('automationCredentials').AzureCredentials.credentialName)]"
          ],
          "tags": { },
          "properties": {
            "runbookType": "[variables('runbooks').SetOMSLogAnalyticsIntelligencePack.runbookType]",
            "logProgress": "false",
            "logVerbose": "false",
            "description": "[variables('runbooks').SetOMSLogAnalyticsIntelligencePack.runbookDescription]",
            "publishContentLink": {
              "uri": "[variables('runbooks').SetOMSLogAnalyticsIntelligencePack.runbookURL]",
              "version": "[variables('runbooks').SetOMSLogAnalyticsIntelligencePack.runbookVersion]"
            }
          }
        },
        {
          "name": "[variables('runbooks').InstallOMSLogAnalyticsVMExtension.runbookName]",
          "type": "runbooks",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMCompute.ModuleName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/jobs/', variables('runbooks').SetOMSAutomationVariable.runbookJobId)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').AzureSubscriptionID.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/credentials/', variables('automationCredentials').AzureCredentials.credentialName)]"
          ],
          "tags": { },
          "properties": {
            "runbookType": "[variables('runbooks').InstallOMSLogAnalyticsVMExtension.runbookType]",
            "logProgress": "false",
            "logVerbose": "false",
            "description": "[variables('runbooks').InstallOMSLogAnalyticsVMExtension.runbookDescription]",
            "publishContentLink": {
              "uri": "[variables('runbooks').InstallOMSLogAnalyticsVMExtension.runbookURL]",
              "version": "[variables('runbooks').InstallOMSLogAnalyticsVMExtension.runbookVersion]"
            }
          }
        },
        {
          "name": "[variables('runbooks').SetHybridWorkerDSCConfiguration.runbookName]",
          "type": "runbooks",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMAutomation.ModuleName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').AzureSubscriptionID.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').OMSAutomationAccountName.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').OMSAutomationAccountResourceGroup.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/credentials/', variables('automationCredentials').AzureCredentials.credentialName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Configurations/', variables('DSCConfigurations').SetHybridWorker.configurationName)]"
          ],
          "tags": { },
          "properties": {
            "runbookType": "[variables('runbooks').SetHybridWorkerDSCConfiguration.runbookType]",
            "logProgress": "false",
            "logVerbose": "false",
            "description": "[variables('runbooks').SetHybridWorkerDSCConfiguration.runbookDescription]",
            "publishContentLink": {
              "uri": "[variables('runbooks').SetHybridWorkerDSCConfiguration.runbookURL]",
              "version": "[variables('runbooks').SetHybridWorkerDSCConfiguration.runbookVersion]"
            }
          }
        },
        {
          "name": "[variables('runbooks').RegisterOMSAutomationDSCNode.runbookName]",
          "type": "runbooks",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMResources.ModuleName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellModules').AzureRMCompute.ModuleName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/variables/', variables('automationVariables').AzureSubscriptionID.variableName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/jobs/', variables('runbooks').SetOMSAutomationVariable.runbookJobId)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/credentials/', variables('automationCredentials').AzureCredentials.credentialName)]"
          ],
          "tags": { },
          "properties": {
            "runbookType": "[variables('runbooks').RegisterOMSAutomationDSCNode.runbookType]",
            "logProgress": "false",
            "logVerbose": "false",
            "description": "[variables('runbooks').RegisterOMSAutomationDSCNode.runbookDescription]",
            "publishContentLink": {
              "uri": "[variables('runbooks').RegisterOMSAutomationDSCNode.runbookURL]",
              "version": "[variables('runbooks').RegisterOMSAutomationDSCNode.runbookVersion]"
            }
          }
        },
        {
          "name": "[variables('runbooks').SetOMSAutomationVariable.runbookJobId]",
          "type": "jobs",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsLogAnalyticsWorkspaceName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/runbooks/', variables('runbooks').SetOMSAutomationVariable.runbookName)]"
          ],
          "tags": { },
          "properties": {
            "runbook": {
              "name": "[variables('runbooks').SetOMSAutomationVariable.runbookName]"
            },
            "parameters": {
            }
          }
        },
        {
          "name": "[variables('runbooks').SetOMSLogAnalyticsIntelligencePack.runbookJobId]",
          "type": "jobs",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsLogAnalyticsWorkspaceName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/runbooks/', variables('runbooks').SetOMSLogAnalyticsIntelligencePack.runbookName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/jobs/', variables('runbooks').SetOMSAutomationVariable.runbookJobId)]"
          ],
          "tags": { },
          "properties": {
            "runbook": {
              "name": "[variables('runbooks').SetOMSLogAnalyticsIntelligencePack.runbookName]"
            },
            "parameters": {
              "EnableCapacity": "[parameters('omsLogAnalyticsEnableCapacitySolution')]",
              "EnableSecurity": "[parameters('omsLogAnalyticsEnableSecurityAndAuditSolution')]",
              "EnableUpdates": "[parameters('omsLogAnalyticsEnableSystemUpdateAssessmentSolution')]",
              "EnableAntiMalware": "[parameters('omsLogAnalyticsEnableAntimalwareAssesmentSolution')]",
              "EnableLogManagement": "[parameters('omsLogAnalyticsEnableLogManagementSolution')]",
              "EnableChangeTracking": "[parameters('omsLogAnalyticsEnableChangeTrackingSolution')]",
              "EnableSQLAssessment": "[parameters('omsLogAnalyticsEnableSQLAssessmentSolution')]",
              "EnableADAssessment": "[parameters('omsLogAnalyticsEnableADAssessmentSolution')]",
              "EnableAlertManagement": "[parameters('omsLogAnalyticsEnableAlertManagementSolution')]",
              "EnableAzureAutomation": "[parameters('omsLogAnalyticsEnableAutomationSolution')]",
              "EnableWireData": "[parameters('omsLogAnalyticsEnableWireDataSolution')]",
              "EnableSiteRecovery": "[parameters('omsLogAnalyticsEnableSiteRecoverySolution')]",
              "EnableBackup": "[parameters('omsLogAnalyticsEnableBackupSolution')]",
              "EnableSurfaceHub": "[parameters('omsLogAnalyticsEnableSurfaceHubSolution')]",
              "EnableNetworkMonitoring": "[parameters('omsLogAnalyticsEnableNetworkPerformanceMonitorSolution')]",
              "EnableContainers": "[parameters('omsLogAnalyticsEnableContainersSolution')]",
              "EnableAzureNetworking": "[parameters('omsLogAnalyticsEnableAzureNetworkAnalyticsSolution')]",
              "EnableADReplication": "[parameters('omsLogAnalyticsEnableADReplicationSolution')]",
              "EnableOffice365": "[parameters('omsLogAnalyticsEnableOffice365Solution')]"
            }
          }
        },
        {
          "name": "[variables('DSCConfigurations').SetHybridWorker.configurationName]",
          "type": "Configurations",
          "apiVersion": "[parameters('omsAutomationApiVersion')]",
          "location": "[parameters('omsAutomationAccountLocation')]",
          "dependsOn": [
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'))]",
            "[concat('Microsoft.OperationalInsights/workspaces/', parameters('omsLogAnalyticsWorkspaceName'))]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/Modules/', variables('PowerShellDSCModules').xHybridRegistration.ModuleName)]",
            "[concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName'), '/jobs/', variables('runbooks').SetOMSAutomationVariable.runbookJobId)]"
          ],
          "tags": { },
          "properties": {
            "logVerbose": "false",
            "description": "[variables('DSCConfigurations').SetHybridWorker.configurationDescription]",
            "state": "Published",
            "overwrite": "[variables('DSCConfigurations').SetHybridWorker.dscOverwrite]",
            "Source": {
              "type": "uri",
              "Value": "[variables('DSCConfigurations').SetHybridWorker.configurationURI]"
            }
          }
        }
      ]
    }

  ],
  "outputs": {
    "workspaceID": {
      "value": "[reference(Concat('Microsoft.OperationalInsights/workspaces/', parameters('omsLogAnalyticsWorkspaceName')), parameters('omsLogAnalyticsWorkspaceApiVersion')).customerId]",
      "type": "string"
    },
    "Automation": {
      "value": "[reference(Concat('Microsoft.Automation/automationAccounts/', parameters('omsAutomationAccountName')), parameters('omsAutomationApiVersion'))]",
      "type": "object"
    }
  }
}